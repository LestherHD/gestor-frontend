import{a as C}from"./chunk-C6TJHT6G.js";import{a as z,b as H,c as $}from"./chunk-W2W7ET63.js";import{c as J,d as _,e as K,f as Q,g,j as b,m as W,p as X,r as Y,y as Z}from"./chunk-G72JZGS3.js";import{Ea as n,Eb as V,Fa as o,Ga as y,Ka as v,M as w,Ma as f,Na as m,Oc as T,Pc as q,Qa as E,Qb as k,Rc as P,T as d,U as p,Xa as c,Ya as S,eb as R,fa as a,ga as h,jd as A,kd as D,ld as G,ra as F,rd as j,sd as M,ua as s,ud as N,wd as O,xc as B,xd as L,zb as U,zc as I}from"./chunk-5KS4DSO7.js";import{k as x}from"./chunk-LTV2K23E.js";function ee(l,u){if(l&1&&(n(0,"c-alert",7),c(1),o()),l&2){let i=m();E("color",i.typeAlert),a(),S(i.mensajeError)}}function re(l,u){if(l&1){let i=v();n(0,"form",8)(1,"p",9),c(2,"Ingrese su usuario o correo"),o(),n(3,"c-input-group",10)(4,"div",11)(5,"input",12),f("blur",function(){d(i);let e=m();return p(e.functionsUtils.removeSpaces("usuario",e.formUsuario))}),o(),n(6,"label",13),c(7,"Usuario"),o(),n(8,"c-form-feedback",14),c(9,"Campo requerido."),o()()(),n(10,"c-row")(11,"c-col",15)(12,"button",16),f("click",function(){d(i);let e=m();return p(e.validarUsuario())}),c(13," Aceptar "),o()(),n(14,"c-col",17)(15,"a",18),f("click",function(){d(i);let e=m();return p(e.login())}),c(16," Iniciar sesi\xF3n "),o()()()()}if(l&2){let i=m();s("formGroup",i.formUsuario),a(4),s("cFormFloating",!0),a(),s("valid",i.campoRequerido(i.formUsuario,"usuario")==1?!1:null),a(3),s("valid",!1),a(4),s("disabled",i.formUsuario.invalid||i.service.deshabilitarBotones)}}function ie(l,u){if(l&1){let i=v();n(0,"form",8)(1,"p",9),c(2,"Contacte con el encargado e ingrese c\xF3digo de confirmaci\xF3n enviado al correo"),o(),n(3,"c-input-group",10)(4,"div",11)(5,"input",19),f("blur",function(){d(i);let e=m();return p(e.functionsUtils.removeSpaces("codigo",e.formConfirmarCodigo))}),o(),n(6,"label",20),c(7,"C\xF3digo"),o(),n(8,"c-form-feedback",14),c(9,"Campo requerido."),o()()(),n(10,"c-row")(11,"c-col",15)(12,"button",16),f("click",function(){d(i);let e=m();return p(e.confirmarCodigo())}),c(13," Aceptar "),o()(),n(14,"c-col",17)(15,"a",18),f("click",function(){d(i);let e=m();return p(e.login())}),c(16," Iniciar sesi\xF3n "),o()()()()}if(l&2){let i=m();s("formGroup",i.formConfirmarCodigo),a(4),s("cFormFloating",!0),a(),s("valid",i.campoRequerido(i.formConfirmarCodigo,"codigo")==1?!1:null),a(3),s("valid",!1),a(4),s("disabled",i.formConfirmarCodigo.invalid||i.service.deshabilitarBotones)}}function te(l,u){if(l&1){let i=v();n(0,"form",8)(1,"p",9),c(2,"Ingrese la nueva contrase\xF1a"),o(),n(3,"c-input-group",10)(4,"div",11)(5,"input",21),f("blur",function(){d(i);let e=m();return p(e.functionsUtils.removeSpaces("contrasenia",e.formConfirmarCambio))}),o(),n(6,"label",22),c(7,"Contrase\xF1a"),o(),n(8,"c-form-feedback",14),c(9,"Campo requerido."),o()()(),n(10,"c-row")(11,"c-col",15)(12,"button",16),f("click",function(){d(i);let e=m();return p(e.cambiarContrasenia())}),c(13," Confirmar "),o()(),n(14,"c-col",17)(15,"a",18),f("click",function(){d(i);let e=m();return p(e.login())}),c(16," Iniciar sesi\xF3n "),o()()()()}if(l&2){let i=m();s("formGroup",i.formConfirmarCambio),a(4),s("cFormFloating",!0),a(),s("valid",i.campoRequerido(i.formConfirmarCambio,"contrasenia")==1?!1:null),a(3),s("valid",!1),a(4),s("disabled",i.formConfirmarCambio.invalid||i.service.deshabilitarBotones)}}var _e=(()=>{let u=class u{constructor(t,e,r){this.service=t,this.router=e,this.functionsUtils=r,this.formUsuario=this.llenarFormUsuario(),this.formConfirmarCodigo=this.llenarFormConfirmarCodigo(),this.formConfirmarCambio=this.llenarFormConfirmarCambio(),this.isError=!1,this.service.deshabilitarBotones=!1,this.service.mostrarSpinner=!1,this.mensajeError="",this.typeAlert=""}ngOnInit(){}llenarFormUsuario(){return new g({usuario:new b("",_.required)})}llenarFormConfirmarCodigo(){return new g({codigo:new b("",_.required)})}llenarFormConfirmarCambio(){return new g({contrasenia:new b("",_.required)})}campoRequerido(t,e){return t.controls[e].value.trim()===""&&t.controls[e].touched?1:0}validarUsuario(){return x(this,null,function*(){if(this.service.deshabilitarBotones=!0,this.functionsUtils.validarControlsRequeridos(this.formUsuario))return;this.isError=!1;let t=this.formUsuario.controls.usuario.value,e=null;e=new C(t,t,"","","R",null,0,0),this.service.mostrarSpinner=!0,yield this.service.getFromEntityAndMethodPromise("usuarios","getByUsuarioOrCorreo",e).then(r=>{this.isError=r.error,this.mensajeError=r.respuesta,this.typeAlert=r.error&&!this.isConfirmed?"danger":"success",this.service.deshabilitarBotones=!1,this.service.mostrarSpinner=!1,this.usuario=r.usuario}).catch(r=>{this.service.deshabilitarBotones=!1,this.service.mostrarSpinner=!1,console.error(r)}),this.isError||(this.service.deshabilitarBotones=!0,this.service.mostrarSpinner=!0,this.isError=!1,e=new C(t,t,"","","R",null,0,0),yield this.service.getFromEntityAndMethodPromise("usuarios","recover-password",e).then(r=>{this.isError=r.error,this.isConfirmed=r.confirmado,this.mensajeError=r.respuesta,this.typeAlert=r.error&&!this.isConfirmed?"danger":"success",setTimeout(()=>{this.service.deshabilitarBotones=!1,this.service.mostrarSpinner=!1,this.usuario=r.usuario},1e3)}).catch(r=>{this.service.deshabilitarBotones=!1,this.service.mostrarSpinner=!1,console.error(r)}))})}confirmarCodigo(){if(this.isError=!1,this.isConfirmed=!1,this.service.deshabilitarBotones=!0,this.functionsUtils.validarControlsRequeridos(this.formConfirmarCodigo))return;let t=this.formConfirmarCodigo.controls.codigo.value,e=new C(this.usuario.usuario,this.usuario.correo,t,"","R",null,0,0);this.service.mostrarSpinner=!0,this.service.getFromEntityAndMethod("usuarios","update-user-password",e).subscribe(r=>{this.isError=r.error,this.mensajeError=r.respuesta,this.typeAlert=r.error&&!r.confirmado?"danger":"success",this.service.mostrarSpinner=!1,setTimeout(()=>{this.isConfirmed=r.confirmado,this.isError=!1,this.service.deshabilitarBotones=!1},3e3)},r=>{this.service.deshabilitarBotones=!1,this.service.mostrarSpinner=!1,console.error(r)})}cambiarContrasenia(){if(this.service.deshabilitarBotones=!0,this.functionsUtils.validarControlsRequeridos(this.formConfirmarCambio))return;let t=this.formConfirmarCambio.controls.contrasenia.value,e=new C(this.usuario.usuario,this.usuario.correo,"",this.service.hashMD5(t),"R",null,0,0);this.service.mostrarSpinner=!0,this.service.getFromEntityAndMethod("usuarios","update-user-password",e).subscribe(r=>{this.isError=r.error,this.isConfirmed=r.confirmado,this.mensajeError=r.respuesta,this.typeAlert=r.error&&!this.isConfirmed?"danger":"success",this.service.mostrarSpinner=!1,this.isConfirmed&&setTimeout(()=>{this.service.deshabilitarBotones=!1,this.functionsUtils.navigateOption(this.router,"/login")},1600)},r=>{this.service.mostrarSpinner=!1,this.service.deshabilitarBotones=!1,console.error(r)})}login(){this.functionsUtils.navigateOption(this.router,"login")}};u.\u0275fac=function(e){return new(e||u)(h(H),h(k),h(z))},u.\u0275cmp=w({type:u,selectors:[["app-recover-password"]],standalone:!0,features:[R],decls:14,vars:4,consts:[[1,"bg-light","dark:bg-transparent","min-vh-100","d-flex","flex-row","align-items-center"],["breakpoint","md"],[1,"justify-content-center"],["lg","10","xl","4"],[1,"p-4"],[3,"color",4,"ngIf"],["cForm","",3,"formGroup",4,"ngIf"],[3,"color"],["cForm","",3,"formGroup"],[1,"text-body-secondary"],[1,"mb-3"],[3,"cFormFloating"],["id","usuario","autoComplete","username","formControlName","usuario","cFormControl","","placeholder","Usuario o correo",3,"blur","valid"],["cLabel","","for","usuario"],[3,"valid"],["xs","7"],["cButton","","color","primary",1,"px-4",3,"click","disabled"],["xs","5"],["cButton","","color","link",1,"px-0",3,"click"],["id","codigo","autoComplete","codigo","formControlName","codigo","cFormControl","","placeholder","C\xF3digo",3,"blur","valid"],["cLabel","","for","codigo"],["id","contrasenia","type","password","autoComplete","contrasenia","formControlName","contrasenia","cFormControl","","placeholder","Contrase\xF1a",3,"blur","valid"],["cLabel","","for","contrasenia"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"c-container",1)(2,"c-row",2)(3,"c-col",3)(4,"c-card-group")(5,"c-card",4)(6,"c-card-body")(7,"h3"),c(8,"Recuperar contrase\xF1a"),o(),F(9,ee,2,2,"c-alert",5)(10,re,17,5,"form",6)(11,ie,17,5,"form",6)(12,te,17,5,"form",6),o()()()()()()(),y(13,"app-custom-spinner")),e&2&&(a(9),s("ngIf",r.isError),a(),s("ngIf",!r.usuario),a(),s("ngIf",r.usuario&&!r.isConfirmed),a(),s("ngIf",r.usuario&&r.isConfirmed))},dependencies:[N,L,O,P,T,q,A,G,j,B,I,V,U,Z,W,J,K,Q,X,Y,D,M,$],styles:["button[_ngcontent-%COMP%]    {background-color:#00b3ba!important;border-color:#00b3ba!important}"]});let l=u;return l})();export{_e as RecoverPasswordComponent};
